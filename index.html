<!DOCTYPE html>
<html>
<head>
    <title>GCSegmentedArray Bug Demonstration</title>
</head>
<body>
<script>
(function() {
    function triggerBug() {
        // Step 1: Fill the segmented array to create multiple segments
        let arr = [];
        const segmentCapacity = 1024; // Hypothetical value
        const numSegments = 5;
        const totalElements = segmentCapacity * numSegments - 500; // Leave last segment partially filled

        for (let i = 0; i < totalElements; i++) {
            arr.push(i);
        }

        // Step 2: Remove elements to empty the current segment
        for (let i = 0; i < segmentCapacity; i++) {
            arr.pop();
        }

        // Step 3: Force the refill operation
        // Assume that certain operations in the JS engine will cause refill() to be called
        // For example, accessing an element that triggers internal mechanisms
        arr.push(0); // Append to potentially trigger refill

        // Step 4: Access elements to cause out-of-bounds access due to incorrect m_top
        for (let i = 0; i < arr.length; i++) {
            let value = arr[i];
            // Perform operations with value to prevent optimization
            if (value === -1) {
                console.log('This will never happen.');
            }
        }
    }

    // Run the test and catch any potential errors
    try {
        triggerBug();
        console.log('Test completed without triggering the bug.');
    } catch (e) {
        console.error('Bug triggered:', e);
        alert('Bug triggered: ' + e);
    }
})();
</script>
</body>
</html>
