<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safari Crash Demo</title>
</head>
<body>
    <button id="trigger">Trigger Potential Bug</button>
    <script>
        class SegmentedArray {
            constructor() {
                this.segments = [[]];
                this.top = 0;
                this.numberOfSegments = 1;
            }

            expand() {
                if (this.top === 5) {  // Simulating segment capacity
                    this.segments.push([]);
                    this.numberOfSegments++;
                    this.top = 0;
                }
            }

            append(value) {
                this.expand();
                this.segments[this.numberOfSegments - 1].push(value);
                this.top++;
            }

            clear() {
                this.segments = [[]];
                this.numberOfSegments = 1;
                this.top = 0;
            }

            destructor() {
                console.assert(this.numberOfSegments === 1, "Expected only 1 segment");
                console.assert(this.segments.length === 1, "Expected segment size to be 1");
                // Improper cleanup, could lead to memory issues or crashes
                this.segments.pop();
                this.numberOfSegments--;
                console.assert(this.numberOfSegments === 0, "Segments not cleared properly");
            }
        }

        document.getElementById('trigger').addEventListener('click', () => {
            try {
                let arr = new SegmentedArray();
                for (let i = 0; i < 10000; i++) {
                    arr.append(i);
                    if (i % 1000 === 0) arr.clear();
                }
                arr.destructor(); // Call destructor in an unsafe way
            } catch (error) {
                console.error("Error triggered: ", error);
            }
        });
    </script>
</body>
</html>

