<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Memory Leak and Stack Simulation</title>
</head>
<body>
    <button id="trigger">Simulate Memory Leak</button>
    <script>
        // Simulating an unsafe "buffer" by creating an oversized array
        let buffer = new Array(1e7); // Large array to simulate a buffer
        let simulatedThreads = [];
        
        // Fill buffer to simulate memory usage
        function unsafeFillBuffer() {
            for (let i = 0; i < buffer.length; i++) {
                buffer[i] = i;
            }
            console.log("Buffer filled.");
        }

        // Simulate a memory leak by continuously expanding the buffer without freeing it
        function memoryLeak() {
            console.log("Starting memory leak...");
            let leakedBuffers = [];
            setInterval(() => {
                leakedBuffers.push(new Array(1e6).fill(0)); // Add large arrays periodically
                console.log("Leaked buffer size:", leakedBuffers.length * 1e6);
            }, 100);
        }

        // Simulate "thread" creation and unsafe handling by recursive function calls
        function simulateThreads() {
            function recursiveTask(depth) {
                if (depth === 0) return;
                simulatedThreads.push(setTimeout(() => {
                    console.log("Simulated thread task at depth:", depth);
                    recursiveTask(depth - 1);
                }, 10));
            }
            recursiveTask(10000); // High depth for a large "stack"
        }

        document.getElementById("trigger").addEventListener("click", () => {
            unsafeFillBuffer();  // Step 1: Fill the buffer
            memoryLeak();        // Step 2: Simulate memory leak
            simulateThreads();    // Step 3: Simulate threads
        });
    </script>
</body>
</html>
